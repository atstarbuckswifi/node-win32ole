<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>node-win32ole by odysseus654</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>node-win32ole</h1>
        <h2>Win32ole bindings for node.js .</h2>

        <section id="downloads">
          <a href="https://github.com/odysseus654/node-win32ole/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/odysseus654/node-win32ole/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/odysseus654/node-win32ole" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="name" class="anchor" href="#name" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>NAME</h1>

<p>node-win32ole - win32ole bindings for <a href="https://github.com/joyent/node">node.js</a> powered by v8 engine .</p>

<p>win32ole makes accessibility from node.js to Excel, Word, Access, Outlook, InternetExplorer, WSH ( ActiveXObject / COM ) and so on. It does not need a type library, although it will function better if OLE objects provide type information.</p>

<h1>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>USAGE</h1>

<p>Install with (nothing yet, this is still a private fork.  Soon?).</p>

<p>It works as... (version 0.1.x)</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">try</span>{
  <span class="pl-k">var</span> win32ole <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>win32ole<span class="pl-pds">'</span></span>);
  <span class="pl-c">// documented at https://msdn.microsoft.com/en-us/library/microsoft.office.interop.excel._application_members.aspx</span>
  <span class="pl-c">// var xl = new ActiveXObject('Excel.Application'); // You may write it as:</span>
  <span class="pl-k">var</span> xl <span class="pl-k">=</span> <span class="pl-smi">win32ole</span>.<span class="pl-smi">client</span>.<span class="pl-en">Dispatch</span>(<span class="pl-s"><span class="pl-pds">'</span>Excel.Application<span class="pl-pds">'</span></span>);
  <span class="pl-smi">xl</span>.<span class="pl-smi">Visible</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;
  <span class="pl-k">var</span> book <span class="pl-k">=</span> <span class="pl-smi">xl</span>.<span class="pl-smi">Workbooks</span>.<span class="pl-en">Add</span>();
  <span class="pl-k">var</span> sheet <span class="pl-k">=</span> <span class="pl-smi">book</span>.<span class="pl-smi">Worksheets</span>[<span class="pl-c1">1</span>];
  <span class="pl-k">try</span>{
    <span class="pl-smi">sheet</span>.<span class="pl-smi">Name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>sheetnameA utf8<span class="pl-pds">'</span></span>;
    <span class="pl-smi">sheet</span>.<span class="pl-en">get_Cells</span>(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>).<span class="pl-smi">Value</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>test utf8<span class="pl-pds">'</span></span>;
    <span class="pl-k">var</span> rg <span class="pl-k">=</span> <span class="pl-smi">sheet</span>.<span class="pl-en">get_Range</span>(<span class="pl-smi">sheet</span>.<span class="pl-en">get_Cells</span>(<span class="pl-c1">2</span>, <span class="pl-c1">2</span>), <span class="pl-smi">sheet</span>.<span class="pl-en">get_Cells</span>(<span class="pl-c1">4</span>, <span class="pl-c1">4</span>));
    <span class="pl-smi">rg</span>.<span class="pl-smi">RowHeight</span> <span class="pl-k">=</span> <span class="pl-c1">5.18</span>;
    <span class="pl-smi">rg</span>.<span class="pl-smi">ColumnWidth</span> <span class="pl-k">=</span> <span class="pl-c1">0.58</span>;
    <span class="pl-smi">rg</span>.<span class="pl-smi">Interior</span>.<span class="pl-smi">ColorIndex</span> <span class="pl-k">=</span> <span class="pl-c1">6</span>; <span class="pl-c">// Yellow</span>
    <span class="pl-k">var</span> result <span class="pl-k">=</span> <span class="pl-smi">book</span>.<span class="pl-en">SaveAs</span>(<span class="pl-s"><span class="pl-pds">'</span>testfileutf8.xls<span class="pl-pds">'</span></span>);
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(result);
  }<span class="pl-k">catch</span>(e){
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>(exception cached)<span class="pl-cce">\n</span><span class="pl-pds">'</span></span> <span class="pl-k">+</span> e);
  }
  <span class="pl-smi">xl</span>.<span class="pl-smi">ScreenUpdating</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;
  <span class="pl-smi">xl</span>.<span class="pl-smi">Workbooks</span>.<span class="pl-en">Close</span>();
  <span class="pl-smi">xl</span>.<span class="pl-en">Quit</span>();
}<span class="pl-k">catch</span>(e){
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>*** exception cached ***<span class="pl-cce">\n</span><span class="pl-pds">'</span></span> <span class="pl-k">+</span> e);
}</pre></div>

<h1>
<a id="intro" class="anchor" href="#intro" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Intro</h1>

<p>Microsoft introduced <a href="https://en.wikipedia.org/wiki/Component_Object_Model">COM</a> in 1993 and pushed it as the primary means of having applications communicate with each other.  While more recently Microsoft has been transitioning to use of .NET components which cannot be seen or used by COM applications, they are still providing COM interfaces for most of their products (and making it <a href="http://anturcynhyrfus.blogspot.com/2011/03/creating-com-visible-c-component.html">easy for developers to make C# COM-visible</a>).</p>

<p>This library permits call to COM objects that support the <a href="https://en.wikipedia.org/wiki/IDispatch">IDispatch</a> interface.  This allows us to interrogate the object's properties and gives us a means to call into it designed for scripting languages.  IDispatch is tightly built around the Visual Basic and the VBScript languages and share many of the assumptions that those languages make, which can be very different from Javascript.</p>

<p>The IDispatch interface permits objects to refuse to tell us what properties they have.  In this case this library will still permit the objects to be used, but will fall back to less intelligent behavior.</p>

<h1>
<a id="members-and-types" class="anchor" href="#members-and-types" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Members and Types</h1>

<p>Objects can contain methods and properties.  Methods are similar to function calls and do something, while properties are similar to variables and can be read (and sometimes assigned).  Both methods and properties can take parameters (although for properties they are called "indexes".</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">thisObject</span>.<span class="pl-c1">action</span>(); <span class="pl-c">// method call with no arguments</span>
<span class="pl-smi">thisObject</span>.<span class="pl-c1">action</span>(argA, argB, argC); <span class="pl-c">// method call with three arguments</span>

<span class="pl-k">var</span> here <span class="pl-k">=</span> <span class="pl-smi">thisObject</span>.<span class="pl-smi">prop</span>; <span class="pl-c">// retrieving a property value</span>
<span class="pl-smi">thisObject</span>.<span class="pl-smi">prop</span> <span class="pl-k">=</span> <span class="pl-c1">3.4</span>; <span class="pl-c">// assigning a property value</span>

<span class="pl-c">// a propety with a single index parameter is treated as a property or array</span>
<span class="pl-k">var</span> here <span class="pl-k">=</span> <span class="pl-smi">thisObject</span>.<span class="pl-smi">indexedProp</span>[<span class="pl-s"><span class="pl-pds">'</span>abc<span class="pl-pds">'</span></span>];
<span class="pl-smi">thisObject</span>.<span class="pl-smi">indexedProp</span>[<span class="pl-c1">123</span>] <span class="pl-k">=</span> <span class="pl-c1">3.4</span>;
<span class="pl-k">var</span> here <span class="pl-k">=</span> <span class="pl-smi">thisObject</span>.<span class="pl-smi">indexedProp</span>.<span class="pl-smi">abc</span>;
<span class="pl-smi">thisObject</span>.<span class="pl-smi">indexedProp</span>.<span class="pl-smi">abc</span> <span class="pl-k">=</span> <span class="pl-c1">3.4</span>;

<span class="pl-c">// a property with more than one index parameter needs to be treated as if it were a method</span>
<span class="pl-k">var</span> here <span class="pl-k">=</span> <span class="pl-smi">thisObject</span>.<span class="pl-en">get_complexProp</span>(<span class="pl-s"><span class="pl-pds">'</span>abc<span class="pl-pds">'</span></span>, <span class="pl-c1">123</span>);
<span class="pl-smi">thisObject</span>.<span class="pl-en">put_complexProp</span>(<span class="pl-s"><span class="pl-pds">'</span>abc<span class="pl-pds">'</span></span>, <span class="pl-c1">123</span>, <span class="pl-c1">3.4</span>); <span class="pl-c">// value to set is in the last parameter</span></pre></div>

<p><strong>Arguments:</strong> The simplest way to call a method is to call it with a number of arguments i.e. <strong><code>thisObject.action(argA, argB, argC)</code></strong>.  In this instance the three arguments will be translated to their COM equivalents and passed by-value to the <code>action</code> method of <code>thisObject</code>.  <em>(TODO)</em> Visual Basic (and COM) <a href="https://msdn.microsoft.com/en-us/library/f25e2b6b.aspx">permit the use of "optional parameters"</a>, if <strong><code>argB</code></strong> was an optional paramter not specified then you could call it with <strong><code>thisObject.action(argA, undefined, argC)</code></strong></p>

<p><strong>Default members:</strong> Visual Basic uses separate commands when GET'ting or PUT'ting a value from or to a property depending on whether or not an object is involved and COM does the same.  Assignment or retrieval of non-objects from object properties might be forwarded to "default members" in the property.  For instance, <a href="https://msdn.microsoft.com/en-us/library/ms681510(v=vs.85).aspx">this page here</a> describes the two VB commands as equivalent:</p>

<div class="highlight highlight-source-vbnet"><pre>Debug<span class="pl-k">.</span>Print objRs<span class="pl-k">.</span>Fields<span class="pl-k">.</span>Item(<span class="pl-c1">0</span>)  <span class="pl-c">' Both statements print </span>
Debug<span class="pl-k">.</span>Print objRs(<span class="pl-c1">0</span>)              <span class="pl-c">'  the Value of Item(0).</span></pre></div>

<p>This is because in this context <strong><code>Fields</code></strong> is the default property of <strong><code>objRS</code></strong> and <strong><code>Item</code></strong> is the default property of <strong><code>Fields</code></strong>.  This library tries to support the shortcut syntax described here by attempting to detect when you are attempting to use an object as if it were a non-object.  <a href="http://www.2ality.com/2012/03/converting-to-string.html">If you try to do any arithmatic operations on a COM object or convert it to a string</a>, it will retrieve its "shortcut" property.  Our COM objects also have a special property <strong><code>\_</code></strong> that does this as well (which is the same as calling <strong><code>.valueOf()</code></strong>.</p>

<p><strong>Indirect Arguments <em>(TODO)</em>:</strong> In addition to a list of parameters specified by-value, COM also supports by-reference, return-only, and named parameters.  We can simulate this using the indcall_, indget_, and indput_ special prefixes.  The parameters may include an array of specified parameters, and an object of named parameters.  If any of the parameters have changed the new values will be replaced in the array or object:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">//TODO thisObject.indcall_action([1, 2, 3], {argA:'valA', argB:456});</span>
<span class="pl-k">var</span> args <span class="pl-k">=</span> [<span class="pl-c1">4</span>, <span class="pl-s"><span class="pl-pds">'</span>abc<span class="pl-pds">'</span></span>, <span class="pl-c1">9.3</span>];
<span class="pl-c">//TODO thisObject.indcall_anotherAction(args); // values in args may change</span>
<span class="pl-c">//TODO var here = thisObject.indget_someProp(args);</span>
<span class="pl-c">//TODO thisObject.indput_someProp(args, {argC:4.6}, 3.4); // value to set is still in the last parameter</span></pre></div>

<p><strong>Translation:</strong> Most values that are returned from a COM object will be translated to an equivalent (or approximate) Javascript value.  Most COM datatypes can be translated; if we cannot translate it we will place it within a <strong><code>V8Variant</code></strong> wrapper object so it can be passed as-is back to COM (i.e. as a parameter in a method call or a property value in an assignment).</p>

<p>Passing Javascript values into COM requires translating the values.  The datatypes are translated as follows:</p>

<table>
<thead>
<tr>
<th>Javascript Type</th>
<th>COM Datatype</th>
</tr>
</thead>
<tbody>
<tr>
<td>null</td>
<td>VT_EMPTY (empty)</td>
</tr>
<tr>
<td>undefined <em>(TODO)</em>
</td>
<td>DISP_E_PARAMNOTFOUND (optional parameter not specified) <em>(TODO)</em>
</td>
</tr>
<tr>
<td>boolean</td>
<td>VT_BOOL (Boolean)</td>
</tr>
<tr>
<td>int</td>
<td>VT_I4 (Long)</td>
</tr>
<tr>
<td>uint</td>
<td>VT_UI4 (unsigned Long)</td>
</tr>
<tr>
<td>Number</td>
<td>VT_R8 (Double)</td>
</tr>
<tr>
<td>Date</td>
<td>VT_DATE (Date, note that all OLE dates are local time zone)</td>
</tr>
<tr>
<td>string</td>
<td>VT_BSTR (String)</td>
</tr>
<tr>
<td>V8Variant (wrapper holding unknown datatypes)</td>
<td><em>(contents of the V8Variant)</em></td>
</tr>
<tr>
<td>V8Dispatch (wrapper holding objects)</td>
<td>VT_DISPATCH (Object supporting IDispatch)</td>
</tr>
<tr>
<td>All others</td>
<td><em>throw TypeError</em></td>
</tr>
</tbody>
</table>

<h1>
<a id="garbage-collection" class="anchor" href="#garbage-collection" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Garbage Collection</h1>

<p>There are 3 ways to make force Garbage Collection for node.js / v8 .</p>

<ul>
<li>1. use huge memory to run GC automatically ( causes abnormal termination )</li>
<li>2. win32ole.force_gc_extension(1);</li>
<li>3. win32ole.force_gc_internal(1);</li>
</ul>

<p>see also <a href="https://github.com/idobatter/node-win32ole/blob/master/examples/ole_args_test_client.js">examples/ole_args_test_client.js</a></p>

<h1>
<a id="tutorial-and-examples" class="anchor" href="#tutorial-and-examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tutorial and Examples</h1>

<ul>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/test/init_win32ole.test.js">test/init_win32ole.test.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/test/unicode.test.js">test/unicode.test.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/maze_creator.js">examples/maze_creator.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/maze_solver.js">examples/maze_solver.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/word_sample.js">examples/word_sample.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/access_mdb_sample.js">examples/access_mdb_sample.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/outlook_sample.js">examples/outlook_sample.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/ie_sample.js">examples/ie_sample.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/typelibrary_sample.js">examples/typelibrary_sample.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/uncfinder_sample.js">examples/uncfinder_sample.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/activex_filesystemobject_sample.js">examples/activex_filesystemobject_sample.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/wmi_sample.js">examples/wmi_sample.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/wsh_sample.js">examples/wsh_sample.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/ole_args_test_client.js">examples/ole_args_test_client.js</a></li>
<li><a href="https://github.com/idobatter/node-win32ole/blob/master/examples/ole_args_test_client_metamorphoses.js">examples/ole_args_test_client_metamorphoses.js</a></li>
</ul>

<h1>
<a id="other-built-in-functions" class="anchor" href="#other-built-in-functions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Other built in functions</h1>

<ul>
<li>win32ole.version(void) // returns version string</li>
<li>win32ole.printACP(utf8string) // Utf8 to .ACP</li>
<li>win32ole.print(utf8string) // ASCII</li>
<li>win32ole.gettimeofday(struct timeval &amp;tv, null) // now arg2 is not used</li>
<li>win32ole.sleep(long milliseconds, bool withmessage=false, bool with\n=false)</li>
<li>win32ole.force_gc_extension(long flag) // now flag is dummy</li>
<li>win32ole.force_gc_internal(long flag, string) // now flag is dummy</li>
</ul>

<h1>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FEATURES</h1>

<ul>
<li>fix BUG: date</li>
<li>BUG: A few samples in win32ole@0.1.0 needs '._' ideom.</li>
<li>When you use unary operator '!' at the place that needs boolean CONDITION (for example 'while(!obj.status){...}') , you must write 'while(!obj.status._){...}' to complete v8::Object::ToBoolean() conversion. (NamedPropertyHandler will not be called because v8::Object::ToBoolean() is called directly for unary operator '!' instead of v8::Object::valueOf() in ParseUnaryExpression() v8/src/parser.cc .) Do you know how to fake it?</li>
<li>V8Variant::OLEGetAttr returns a copy of object, so it uses much memory. I want to fix it.</li>
<li>Now '._' ideom is obsoleted.</li>
<li>Remove 'node-proxy' from dependencies list.</li>
<li>Change default branch to dev0.1.0 .</li>
<li>BUG: Some samples in between win32ole@0.0.25 and win32ole@0.0.28 ( examples/maze_creator.js examples/maze_solver.js ) uses huge memory and many disposers will run by v8 GC when maze size is 20*30. I think that each encapsulated V8Variant (by node-proxy) may be big object. So I will try to use v8 accessor handlers ( SetCallAsFunctionHandler / SetNamedPropertyHandler / SetIndexedPropertyHandler ) instead of ( '<strong>noSuchMethod</strong>' / '<strong>noSuchGetter</strong>' / '<strong>noSuchSetter</strong>' ) by node-proxy.</li>
<li>So much implements. (can not handle some COM VARIANT types, array etc.)</li>
<li>Bug fix. (throws exception when failed to Invoke(), and many test message.)</li>
<li>Implement accessors getter, setter and caller. (version 0.1.x) (Some V8Variants were advanced to 0.1.x .)</li>
</ul>

<h1>
<a id="api" class="anchor" href="#api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>API</h1>

<p>See the <a href="https://github.com/idobatter/node-win32ole/wiki">API documentation</a> in the wiki.</p>

<h1>
<a id="building" class="anchor" href="#building" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>BUILDING</h1>

<p>This project uses VC++ 2008 Express (or later) and Python 2.6 (or later) .
(When using Python 2.5, it needs <a href="http://pypi.python.org/pypi/multiprocessing/">multiprocessing 2.5 back port</a> .) It needs neither ATL nor MFC.</p>

<p>Bulding also requires node-gyp to be installed. You can do this with npm:</p>

<pre><code>npm install -g node-gyp
</code></pre>

<p>To obtain and build the bindings:</p>

<pre><code>git clone git://github.com/idobatter/node-win32ole.git
cd node-win32ole
node-gyp configure
node-gyp build
</code></pre>

<p>You can also use <a href="https://github.com/isaacs/npm"><code>npm</code></a> to download and install them:</p>

<pre><code>npm install win32ole
</code></pre>

<h1>
<a id="tests" class="anchor" href="#tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>TESTS</h1>

<p><a href="https://github.com/visionmedia/mocha">mocha</a> is required to run unit tests.</p>

<pre><code>npm install -g mocha
nmake /a test
</code></pre>

<h1>
<a id="contributors" class="anchor" href="#contributors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CONTRIBUTORS</h1>

<ul>
<li><a href="https://github.com/idobatter">idobatter</a></li>
</ul>

<h1>
<a id="acknowledgements" class="anchor" href="#acknowledgements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ACKNOWLEDGEMENTS</h1>

<p>Inspired <a href="http://www.ruby-doc.org/stdlib/libdoc/win32ole/rdoc/">Win32OLE</a></p>

<h1>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>LICENSE</h1>

<p><code>node-win32ole</code> is <a href="https://github.com/idobatter/node-win32ole/raw/master/LICENSE">BSD licensed</a>.</p>
      </section>
    </div>

    
  </body>
</html>
